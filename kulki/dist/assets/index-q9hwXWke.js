(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var g=(r=>(r.ball="ball",r))(g||{});function j(r,e){const t=[],l=r.querySelectorAll(":scope >*>*");for(let s=0;s<e;s++)t.push([]);for(let s=0;s<e*e;s++)t[s%e].push(l[s]);return t}function _(r,e,t){const l=e.querySelectorAll(":scope >*");let s,n;for(let o=0;o<t;o++)if(r.parentNode===l[o]){n=o;const c=l[o];for(let a=0;a<t;a++)c.childNodes[a]===r&&(s=a)}return{x:s,y:n}}function P(r){r.forEach(e=>{e.forEach(t=>{t.classList.remove("openList"),t.classList.remove("closedList"),t.classList.remove("finalPath")})})}function w(r){let e=r;return e.classList.contains(g.ball)?e.parentNode:e}function T(r,e){return Math.floor(Math.random()*(e-r+1)+r)}function k(r,e){P(e),r.finalPath?r.finalPath.forEach(t=>{e[t.x][t.y].classList.add("finalPath")}):r.closedList.forEach(t=>{e[t.x][t.y].classList.add("closedList")})}class G{getEstimate(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}getTileScore(e){return e.estimate+e.travelCost}getFreeAdjacentTiles(e,t,l,s,n){const o=[];for(let c=-1;c<=1;c++)for(let a=-1;a<=1;a++)if((c!=0||a!=0)&&Math.abs(c%2)!=Math.abs(a%2)){let u={x:e.x+c,y:e.y+a};u.x>=0&&u.x<s&&u.y>=0&&u.y<s&&t[u.x][u.y]==null&&o.push({x:u.x,y:u.y,estimate:this.getEstimate(u,n),travelCost:l+1})}return o.sort((c,a)=>this.getTileScore(c)>this.getTileScore(a)?1:0),o}getAdjacentFromClosedList(e,t){return e.filter(l=>Math.abs(l.x-t.x)==1&&Math.abs(l.y-t.y)==0||Math.abs(l.x-t.x)==0&&Math.abs(l.y-t.y)==1)}addUniquePointToArray(e,t){return t.filter(l=>l.x==e.x&&l.y==e.y).length==0?(t.push(e),!0):!1}checkIfPointInList(e,t){return t.filter(l=>l.x==e.x&&e.y==l.y).length>0}findPath(e,t,l,s){if(t.x==l.x&&t.y==l.y)return{success:!1,openList:[],closedList:[]};let n=[],o={x:t.x,y:t.y,travelCost:0};const c=[o];for(this.getFreeAdjacentTiles(o,e,0,s,l).forEach(u=>{n.push(u)});n.length!==0;){if(o=n.sort((i,m)=>this.getTileScore(i)-this.getTileScore(m))[0],c.push(n.shift()),o.x==l.x&&o.y==l.y){const i=[o];for(;!(o.x==t.x&&o.y==t.y);)this.getAdjacentFromClosedList(c,o).some(y=>{if(o.travelCost-1==y.travelCost)return i.push(y),o=y,!0});return{success:!0,openList:n,closedList:c,finalPath:i}}this.getFreeAdjacentTiles(o,e,o.travelCost,s,l).forEach(i=>{this.checkIfPointInList(i,c)||(this.checkIfPointInList(i,n)?i.travelCost>o.travelCost+1&&(i.travelCost=o.travelCost+1):this.addUniquePointToArray(i,n))})}return{success:!1,openList:n,closedList:c}}}const H=new G,p=document.querySelector("#board"),Y=document.querySelector("#boardSizeInput"),D=document.querySelector("#restartGameButton"),R=document.querySelector("#paintPath"),U=document.querySelector("#numberOfColorsInput"),M=document.querySelector("#currentScoreOutput"),V=document.querySelectorAll(".nextBallColor");let L,d,A=0,O=!1,f=[],b=[],h,N,q={x:0,y:0,isPath:!1};D.addEventListener("click",()=>{I()});function I(){O=!1,d=Y.valueAsNumber,N=U.valueAsNumber,A=0,M.innerHTML="0",F(),J();for(let r=0;r<3;){let e=T(0,d-1),t=T(0,d-1);K(e,t)&&r++}}function X(){const r=[];for(let e=0;e<3;){if(S())return!1;const t=T(0,d-1),l=T(0,d-1);if(f[t][l]==null){const s=b[e],n=document.createElement("div");n.classList.add(g.ball,"color"+b[e]),L[t][l].appendChild(n),f[t][l]=s,r.push({posX:t,posY:l,color:s}),e++}}return r.forEach(e=>{B({x:e.posX,y:e.posY},f,e.color,d)}),!S()}function K(r,e){const t=document.createElement("div"),l=T(1,N);t.classList.add(g.ball),t.classList.add("color"+l);const s=p.querySelectorAll(":scope >*")[e].childNodes[r];return s.childNodes.length>0?!1:(s.appendChild(t),f[r][e]=l,!0)}function B(r,e,t,l){function s(x,i){let m=[r],y=1,v=1;for(;;v+=y){let C=v*x+r.x,E=v*i+r.y;if(!(C>=0&&E>=0&&C<l&&E<l))if(y==1){v=0,y=-1;continue}else return m.length>=5?m:[];if(e[C][E]==t)m.push({x:C,y:E});else if(y==1)v=0,y=-1;else return m.length>=5?m:[]}}let n=s(-1,1),o=s(0,1),c=s(1,1),a=s(1,0),u=[...n,...c,...o,...a];if(u.length>0){let x=0;return u.forEach(i=>{e[i.x][i.y]!=null&&(e[i.x][i.y]=null,L[i.x][i.y].innerHTML="",x++)}),z(A+x*x),!0}else return!1}function J(){for(;p.firstChild;)p.removeChild(p.firstChild);f=[];for(let r=0;r<d;r++)f.push([]);for(let r=0;r<d;r++){const e=document.createElement("div");e.classList.add("board__row");for(let t=0;t<d;t++){const l=document.createElement("div");l.classList.add("board__row__tile"),t%2==0?l.classList.add("board__row__tile__even"):l.classList.add("board__row__tile__odd"),l.addEventListener("click",Z),l.addEventListener("mouseover",$),e.appendChild(l)}p.appendChild(e)}L=j(p,d)}function Q(r,e){let t=H.findPath(f,r,e,d);R.checked&&k(t,L),q={x:e.x,y:e.y,isPath:t.success}}function W(){alert("Game over. Your score: "+A)}function S(){return f.every(r=>r.every(e=>e!=null))}function Z(r){if(O)return;const e=w(r.target);let t=_(e,p,d);if(f[t.x][t.y])document.querySelectorAll(".ball").forEach(l=>{l.classList.remove("selected")}),h={x:t.x,y:t.y,htmlElement:e},h.htmlElement.children[0].classList.add("selected");else if(h&&q.isPath){const l=L[t.x][t.y],s=L[h.x][h.y],n=f[h.x][h.y];l.appendChild(s.children[0]),l.children[0].classList.remove("selected"),f[t.x][t.y]=n,f[h.x][h.y]=null,h=null,P(L),!B(t,f,n,d)&&!X()&&W(),F()}}function $(r){const e=r.target.childNodes.length==0&&!r.target.classList.contains(g.ball);if(h&&e){const t=w(r.target);Q(h,_(t,p,d))}}function F(){b=Array.from({length:3},()=>T(1,N)),V.forEach((r,e)=>{r.className="",r.classList.add("color"+b[e],"nextBallColor")})}function z(r){A=r,M.innerHTML=r+""}I();
