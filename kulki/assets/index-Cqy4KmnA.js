(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=t(l);fetch(l.href,n)}})();var C=(r=>(r.ball="ball",r))(C||{});function G(r,e){const t=[],s=r.querySelectorAll(":scope >*>*");for(let l=0;l<e;l++)t.push([]);for(let l=0;l<e*e;l++)t[l%e].push(s[l]);return t}function w(r,e,t){const s=e.querySelectorAll(":scope >*");let l,n;for(let o=0;o<t;o++)if(r.parentNode===s[o]){n=o;const c=s[o];for(let u=0;u<t;u++)c.childNodes[u]===r&&(l=u)}return{x:l,y:n}}function _(r){r.forEach(e=>{e.forEach(t=>{t.classList.remove("openList"),t.classList.remove("closedList"),t.classList.remove("finalPath")})})}function M(r){let e=r;return e.classList.contains(C.ball)?e.parentNode:e}function L(r,e){return Math.floor(Math.random()*(e-r+1)+r)}function D(r,e){_(e),r.finalPath?r.finalPath.forEach(t=>{e[t.x][t.y].classList.add("finalPath")}):r.closedList.forEach(t=>{e[t.x][t.y].classList.add("closedList")})}class J{getEstimate(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}getTileScore(e){return e.estimate+e.travelCost}getFreeAdjacentTiles(e,t,s,l,n){const o=[];for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++)if((c!=0||u!=0)&&Math.abs(c%2)!=Math.abs(u%2)){let d={x:e.x+c,y:e.y+u};d.x>=0&&d.x<l&&d.y>=0&&d.y<l&&t[d.x][d.y]==null&&o.push({x:d.x,y:d.y,estimate:this.getEstimate(d,n),travelCost:s+1})}return o.sort((c,u)=>this.getTileScore(c)>this.getTileScore(u)?1:0),o}getAdjacentFromClosedList(e,t){return e.filter(s=>Math.abs(s.x-t.x)==1&&Math.abs(s.y-t.y)==0||Math.abs(s.x-t.x)==0&&Math.abs(s.y-t.y)==1)}addUniquePointToArray(e,t){return t.filter(s=>s.x==e.x&&s.y==e.y).length==0?(t.push(e),!0):!1}checkIfPointInList(e,t){return t.filter(s=>s.x==e.x&&e.y==s.y).length>0}findPath(e,t,s,l){if(t.x==s.x&&t.y==s.y)return{success:!1,openList:[],closedList:[]};let n=[],o={x:t.x,y:t.y,travelCost:0};const c=[o];for(this.getFreeAdjacentTiles(o,e,0,l,s).forEach(d=>{n.push(d)});n.length!==0;){if(o=n.sort((a,y)=>this.getTileScore(a)-this.getTileScore(y))[0],c.push(n.shift()),o.x==s.x&&o.y==s.y){const a=[o];for(;!(o.x==t.x&&o.y==t.y);)this.getAdjacentFromClosedList(c,o).some(m=>{if(o.travelCost-1==m.travelCost)return a.push(m),o=m,!0});return{success:!0,openList:n,closedList:c,finalPath:a}}this.getFreeAdjacentTiles(o,e,o.travelCost,l,s).forEach(a=>{this.checkIfPointInList(a,c)||(this.checkIfPointInList(a,n)?a.travelCost>o.travelCost+1&&(a.travelCost=o.travelCost+1):this.addUniquePointToArray(a,n))})}return{success:!1,openList:n,closedList:c}}}const Y=new J,O="kulki_scores",p=document.querySelector("#board"),K=document.querySelector("#boardSizeInput"),U=document.querySelector("#restartGameButton"),V=document.querySelector("#paintPath"),X=document.querySelector("#numberOfColorsInput"),P=document.querySelector("#currentScoreOutput"),R=document.querySelectorAll(".nextBallColor");let x,i,S=0,q=!1,f=[],N=[],h,g,B={x:0,y:0,isPath:!1};U.addEventListener("click",()=>{F()});function F(){q=!1,i=K.valueAsNumber,g=X.valueAsNumber,S=0,P.innerHTML="0",k(),Z(),H();for(let r=0;r<3;){let e=L(0,i-1),t=L(0,i-1);W(e,t)&&r++}}function Q(){const r=[];for(let e=0;e<3;){if(I())return!1;const t=L(0,i-1),s=L(0,i-1);if(f[t][s]==null){const l=N[e],n=document.createElement("div");n.classList.add(C.ball,"color"+N[e]),x[t][s].appendChild(n),f[t][s]=l,r.push({posX:t,posY:s,color:l}),e++}}return r.forEach(e=>{j({x:e.posX,y:e.posY},f,e.color,i)}),!I()}function W(r,e){const t=document.createElement("div"),s=L(1,g);t.classList.add(C.ball),t.classList.add("color"+s);const l=p.querySelectorAll(":scope >*")[e].childNodes[r];return l.childNodes.length>0?!1:(l.appendChild(t),f[r][e]=s,!0)}function j(r,e,t,s){function n(a,y){let m=[r],v=1,T=1;for(;;T+=v){let E=T*a+r.x,A=T*y+r.y;if(!(E>=0&&A>=0&&E<s&&A<s))if(v==1){T=0,v=-1;continue}else return m.length>=5?m:[];if(e[E][A]==t)m.push({x:E,y:A});else if(v==1)T=0,v=-1;else return m.length>=5?m:[]}}let o=n(-1,1),c=n(0,1),u=n(1,1),d=n(1,0),b=[...o,...u,...c,...d];if(b.length>0){let a=0;return b.forEach(y=>{e[y.x][y.y]!=null&&(e[y.x][y.y]=null,x[y.x][y.y].innerHTML="",a++)}),se(S+a*a),!0}else return!1}function Z(){for(;p.firstChild;)p.removeChild(p.firstChild);f=[];for(let r=0;r<i;r++)f.push(Array(i).fill(null));for(let r=0;r<i;r++){const e=document.createElement("div");e.classList.add("board__row");for(let t=0;t<i;t++){const s=document.createElement("div");s.classList.add("board__row__tile"),t%2==0?s.classList.add("board__row__tile__even"):s.classList.add("board__row__tile__odd"),s.addEventListener("click",te),s.addEventListener("mouseover",re),e.appendChild(s)}p.appendChild(e)}x=G(p,i)}function $(r,e){let t=Y.findPath(f,r,e,i);V.checked&&D(t,x),B={x:e.x,y:e.y,isPath:t.success}}function z(){ee(S),H(),alert("Game over. Your score: "+S)}function ee(r){try{const e=JSON.parse(localStorage.getItem(O)||"[]");if(!Array.isArray(e))throw new Error("Invalid scores data in localStorage");const t=e.findIndex(l=>l.boardSize===i&&l.numberOfColors===g),s={dateAchieved:new Date().toISOString(),score:r,boardSize:i,numberOfColors:g};t===-1?e.push(s):e[t]=e[t].score>r?e[t]:s,localStorage.setItem(O,JSON.stringify(e))}catch(e){console.error("Failed to save score:",e)}}function I(){return f.every(r=>r.every(e=>e!=null))}function te(r){if(q)return;const e=M(r.target);let t=w(e,p,i);if(f[t.x][t.y])document.querySelectorAll(".ball").forEach(s=>{s.classList.remove("selected")}),h={x:t.x,y:t.y,htmlElement:e},h.htmlElement.children[0].classList.add("selected");else if(h&&B.isPath){const s=x[t.x][t.y],l=x[h.x][h.y],n=f[h.x][h.y];s.appendChild(l.children[0]),s.children[0].classList.remove("selected"),f[t.x][t.y]=n,f[h.x][h.y]=null,h=null,_(x),!j(t,f,n,i)&&!Q()&&z(),k()}}function re(r){const e=r.target.childNodes.length==0&&!r.target.classList.contains(C.ball);if(h&&e){const t=M(r.target);$(h,w(t,p,i))}}function k(){N=Array.from({length:3},()=>L(1,g)),R.forEach((r,e)=>{r.className="",r.classList.add("color"+N[e],"nextBallColor")})}function se(r){S=r,P.innerHTML=r+""}function le(){const e=JSON.parse(localStorage.getItem(O)||"[]").find(t=>t.boardSize===i&&t.numberOfColors===g);return(e==null?void 0:e.score)||0}function H(){const r=document.querySelector("#bestScoreOutput");r.innerHTML=le()+""}F();
