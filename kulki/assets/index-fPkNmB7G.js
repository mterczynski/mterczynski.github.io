(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}})();var C=(r=>(r.ball="ball",r))(C||{});function H(r,e){const t=[],s=r.querySelectorAll(":scope >*>*");for(let l=0;l<e;l++)t.push([]);for(let l=0;l<e*e;l++)t[l%e].push(s[l]);return t}function I(r,e,t){const s=e.querySelectorAll(":scope >*");let l,o;for(let n=0;n<t;n++)if(r.parentNode===s[n]){o=n;const c=s[n];for(let u=0;u<t;u++)c.childNodes[u]===r&&(l=u)}return{x:l,y:o}}function w(r){r.forEach(e=>{e.forEach(t=>{t.classList.remove("openList"),t.classList.remove("closedList"),t.classList.remove("finalPath")})})}function _(r){let e=r;return e.classList.contains(C.ball)?e.parentNode:e}function g(r,e){return Math.floor(Math.random()*(e-r+1)+r)}function G(r,e){w(e),r.finalPath?r.finalPath.forEach(t=>{e[t.x][t.y].classList.add("finalPath")}):r.closedList.forEach(t=>{e[t.x][t.y].classList.add("closedList")})}class D{getEstimate(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}getTileScore(e){return e.estimate+e.travelCost}getFreeAdjacentTiles(e,t,s,l,o){const n=[];for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++)if((c!=0||u!=0)&&Math.abs(c%2)!=Math.abs(u%2)){let d={x:e.x+c,y:e.y+u};d.x>=0&&d.x<l&&d.y>=0&&d.y<l&&t[d.x][d.y]==null&&n.push({x:d.x,y:d.y,estimate:this.getEstimate(d,o),travelCost:s+1})}return n.sort((c,u)=>this.getTileScore(c)>this.getTileScore(u)?1:0),n}getAdjacentFromClosedList(e,t){return e.filter(s=>Math.abs(s.x-t.x)==1&&Math.abs(s.y-t.y)==0||Math.abs(s.x-t.x)==0&&Math.abs(s.y-t.y)==1)}addUniquePointToArray(e,t){return t.filter(s=>s.x==e.x&&s.y==e.y).length==0?(t.push(e),!0):!1}checkIfPointInList(e,t){return t.filter(s=>s.x==e.x&&e.y==s.y).length>0}findPath(e,t,s,l){if(t.x==s.x&&t.y==s.y)return{success:!1,openList:[],closedList:[]};let o=[],n={x:t.x,y:t.y,travelCost:0};const c=[n];for(this.getFreeAdjacentTiles(n,e,0,l,s).forEach(d=>{o.push(d)});o.length!==0;){if(n=o.sort((i,m)=>this.getTileScore(i)-this.getTileScore(m))[0],c.push(o.shift()),n.x==s.x&&n.y==s.y){const i=[n];for(;!(n.x==t.x&&n.y==t.y);)this.getAdjacentFromClosedList(c,n).some(y=>{if(n.travelCost-1==y.travelCost)return i.push(y),n=y,!0});return{success:!0,openList:o,closedList:c,finalPath:i}}this.getFreeAdjacentTiles(n,e,n.travelCost,l,s).forEach(i=>{this.checkIfPointInList(i,c)||(this.checkIfPointInList(i,o)?i.travelCost>n.travelCost+1&&(i.travelCost=n.travelCost+1):this.addUniquePointToArray(i,o))})}return{success:!1,openList:o,closedList:c}}}const J=new D,N="kulki_scores",p=document.querySelector("#board"),Y=document.querySelector("#boardSizeInput"),K=document.querySelector("#restartGameButton"),U=document.querySelector("#paintPath"),V=document.querySelector("#numberOfColorsInput"),M=document.querySelector("#currentScoreOutput"),X=document.querySelectorAll(".nextBallColor");let L,a,S=0,P=!1,f=[],A=[],h,v,q={x:0,y:0,isPath:!1};K.addEventListener("click",()=>{B()});function B(){P=!1,a=Y.valueAsNumber,v=V.valueAsNumber,S=0,M.innerHTML="0",j(),W(),k();for(let r=0;r<3;){let e=g(0,a-1),t=g(0,a-1);Q(e,t)&&r++}}function R(){const r=[];for(let e=0;e<3;){if(O())return!1;const t=g(0,a-1),s=g(0,a-1);if(f[t][s]==null){const l=A[e],o=document.createElement("div");o.classList.add(C.ball,"color"+A[e]),L[t][s].appendChild(o),f[t][s]=l,r.push({posX:t,posY:s,color:l}),e++}}return r.forEach(e=>{F({x:e.posX,y:e.posY},f,e.color,a)}),!O()}function Q(r,e){const t=document.createElement("div"),s=g(1,v);t.classList.add(C.ball),t.classList.add("color"+s);const l=p.querySelectorAll(":scope >*")[e].childNodes[r];return l.childNodes.length>0?!1:(l.appendChild(t),f[r][e]=s,!0)}function F(r,e,t,s){function l(x,i){let m=[r],y=1,T=1;for(;;T+=y){let b=T*x+r.x,E=T*i+r.y;if(!(b>=0&&E>=0&&b<s&&E<s))if(y==1){T=0,y=-1;continue}else return m.length>=5?m:[];if(e[b][E]==t)m.push({x:b,y:E});else if(y==1)T=0,y=-1;else return m.length>=5?m:[]}}let o=l(-1,1),n=l(0,1),c=l(1,1),u=l(1,0),d=[...o,...c,...n,...u];if(d.length>0){let x=0;return d.forEach(i=>{e[i.x][i.y]!=null&&(e[i.x][i.y]=null,L[i.x][i.y].innerHTML="",x++)}),re(S+x*x),!0}else return!1}function W(){for(;p.firstChild;)p.removeChild(p.firstChild);f=[];for(let r=0;r<a;r++)f.push([]);for(let r=0;r<a;r++){const e=document.createElement("div");e.classList.add("board__row");for(let t=0;t<a;t++){const s=document.createElement("div");s.classList.add("board__row__tile"),t%2==0?s.classList.add("board__row__tile__even"):s.classList.add("board__row__tile__odd"),s.addEventListener("click",ee),s.addEventListener("mouseover",te),e.appendChild(s)}p.appendChild(e)}L=H(p,a)}function Z(r,e){let t=J.findPath(f,r,e,a);U.checked&&G(t,L),q={x:e.x,y:e.y,isPath:t.success}}function $(){z(S),k(),alert("Game over. Your score: "+S)}function z(r){try{const e=JSON.parse(localStorage.getItem(N)||"[]");if(!Array.isArray(e))throw new Error("Invalid scores data in localStorage");const t=e.findIndex(l=>l.boardSize===a&&l.numberOfColors===v),s={dateAchieved:new Date().toISOString(),score:r,boardSize:a,numberOfColors:v};t===-1?e.push(s):e[t]=e[t].score>r?e[t]:s,localStorage.setItem(N,JSON.stringify(e))}catch(e){console.error("Failed to save score:",e)}}function O(){return f.every(r=>r.every(e=>e!=null))}function ee(r){if(P)return;const e=_(r.target);let t=I(e,p,a);if(f[t.x][t.y])document.querySelectorAll(".ball").forEach(s=>{s.classList.remove("selected")}),h={x:t.x,y:t.y,htmlElement:e},h.htmlElement.children[0].classList.add("selected");else if(h&&q.isPath){const s=L[t.x][t.y],l=L[h.x][h.y],o=f[h.x][h.y];s.appendChild(l.children[0]),s.children[0].classList.remove("selected"),f[t.x][t.y]=o,f[h.x][h.y]=null,h=null,w(L),!F(t,f,o,a)&&!R()&&$(),j()}}function te(r){const e=r.target.childNodes.length==0&&!r.target.classList.contains(C.ball);if(h&&e){const t=_(r.target);Z(h,I(t,p,a))}}function j(){A=Array.from({length:3},()=>g(1,v)),X.forEach((r,e)=>{r.className="",r.classList.add("color"+A[e],"nextBallColor")})}function re(r){S=r,M.innerHTML=r+""}function se(){const e=JSON.parse(localStorage.getItem(N)||"[]").find(t=>t.boardSize===a&&t.numberOfColors===v);return(e==null?void 0:e.score)||0}function k(){const r=document.querySelector("#bestScoreOutput");r.innerHTML=se()+""}B();
