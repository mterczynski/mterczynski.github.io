var T=Object.defineProperty;var C=(e,i,t)=>i in e?T(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var o=(e,i,t)=>C(e,typeof i!="symbol"?i+"":i,t);import{C as c,A as x,T as m,S as f,a as b,P as y,e as u,G as v,c as k,b as L}from"./createFullscreenPixiApp-YUXMzY5c.js";import"./index-BkC98qPo.js";const a={initialCanvasWidth:960,initialCanvasHeight:800,cardGap:6,cardWidth:83,cardHeight:115,cardStackMaxVisible:76,flightDurationMs:2e3,transferIntervalMs:1e3,cardStacksOffset:{x:100,y:50}};class d extends c{constructor(){super(),this.init()}async init(){const i="/assets/card.png";await x.load(i);const t=m.from(i),n=new f(t);n.width=a.cardWidth,n.height=a.cardHeight,this.addChild(n)}}class p extends c{constructor(t){super();o(this,"maxVisible",a.cardStackMaxVisible);o(this,"plusText",null);this.init(t)}async init(t){this.removeChildren(),this.plusText&&(this.removeChild(this.plusText),this.plusText=null);const n=Math.min(t,this.maxVisible);for(let s=0;s<n;s++){const r=new d;this.addChild(r),r.y=s*a.cardGap}t>this.maxVisible&&this.showPlusText(t-this.maxVisible)}showPlusText(t){if(this.plusText){this.plusText.text=`+${t}`;return}this.plusText=new b(`+${t}`,{fill:16777215,fontSize:28,fontWeight:"bold",stroke:0,strokeThickness:4,align:"center"}),this.plusText.anchor.set(0,0),this.plusText.x=this.width/2,this.plusText.y=0,this.addChild(this.plusText)}getLength(){if(this.plusText){const t=this.children.filter(s=>s instanceof d).length,n=parseInt(this.plusText.text.slice(1));return t+n}return this.children.filter(t=>t instanceof d).length}appendCard(){const t=this.getLength()+1;if(this.plusText)return this.init(t),null;if(this.children.length<this.maxVisible){const n=new d;return this.addChild(n),n.y=(this.getLength()-1)*a.cardGap,n}else return this.init(t),null}getHeight(){return Math.min(this.getLength(),this.maxVisible)*a.cardGap}async transferTopCardTo(t){if(this.getLength()===0)return;const n=this.children.filter(h=>h instanceof d),s=n[n.length-1],r=this.toGlobal(new y(s.x,s.y));t.parent.addChild(s),s.x=r.x-a.cardStacksOffset.x,s.y=r.y-a.cardStacksOffset.y;let l=!1;if(this.plusText){const h=parseInt(this.plusText.text.slice(1));h>1?(this.showPlusText(h-1),l=!0):(this.removeChild(this.plusText),this.plusText=null)}l||this.removeChild(s),await new Promise(h=>{new u.Tween(s,g).to({x:t.x,y:t.y+t.getHeight()},a.flightDurationMs).easing(u.Easing.Quadratic.InOut).onComplete(()=>{t.parent.removeChild(s),s.destroy(),t.appendCard(),l||this.init(this.getLength()),h()}).start()})}}const g=new v;async function H(){const{app:e}=k({width:a.initialCanvasWidth,height:a.initialCanvasHeight,tweenGroup:g}),i=await S(),t=new c,n=new p(144),s=new p(0);t.addChild(n),t.addChild(s),s.x=100,e.stage.addChild(i),e.stage.addChild(t);const r=L();e.ticker.add(()=>{var h;return(h=r==null?void 0:r.update)==null?void 0:h.call(r)}),P(n,s);const l=()=>{const h=e.renderer.width,w=e.renderer.height;i.width=h,i.height=w,t.x=a.cardStacksOffset.x,t.y=a.cardStacksOffset.y};return window.addEventListener("resize",l),l(),e}async function P(e,i){for(;e.getLength()>0;)await new Promise(t=>setTimeout(t,a.transferIntervalMs)),await e.transferTopCardTo(i)}async function S(){const e="/assets/card table.webp";await x.load(e);const i=f.from(e);return i.width=a.initialCanvasWidth,i.height=a.initialCanvasHeight,i}export{H as init,g as tweenGroup};
